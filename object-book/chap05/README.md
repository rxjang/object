# chap05. 책임 할당하기
### 데이터 중심 설계의 문제점
* 행동보다 데이터를 먼저 결정해 협력이라는 문맥을 벗어나 고립된 개체의 상태에 초점을 맞춰 캡슐화 위반이 쉽다.
* 요소들 사이의 결합도가 높아진다
* 코드를 변경하기 어려워 진다.  

이는 데이터가 아닌 책임에 초점을 맞춤으로 해결할 수 있다.

### 책임에 초점을 맞출시 어려운 점
어떤 객체에 어떤 책임을 할당할지 결정하기 쉽지 않다. 
책임 할당 과정은 일종의 **트레이드오프 활동**이다.
* 동일한 문제를 해결할 수 있는 다양한 책임 할당 방법이 존재한다.
* 어떤 방법이 최선인지는 상황과 문맥에 따라 달라진다.
* 올바른 책임 할당을 위해 다양한 관점에서 설계를 평가할 수 있어야 한다.

---
이번 장에서는 `GRASP 패턴`을 통해 책임 할당의 어려움을 극복해본다.
이를 이해하면 응집도, 결합도, 캡슐화와 같은 다양한 기준에 따라 책임을 할당하고 결과를 트레이드오프 할 수 있는 기준을 배우게 된다. 

## 책임 주도 설계를 향해
데이터 중심의 설계에서 책임 중심의 설꼐로 전환할 때 따라야 하는 원칙
* 데이터보다 행동을 먼저 결정하라
* 협력이라는 문맥 안에서 책임을 결정하라

### 데이터보다 행동을 먼저 결정하라
* 객체에게 중요한것은 외부에 제공하는 행동임
* 클라이언트 관점에서 객체가 수행하는 행동이란 객체의 책임을 의미
* 객체는 협력에 참여하기 위해 존재
* 협력 안에서 수행하는 책임이 객체의 존재가치를 증명

#### 책임 중심의 설계에서는..
1. 이 객체가 수행해야 하는 책임은 무엇인가?
2. 이 책임을 수행하는데 필요한 데이터는 무엇인가?  
순으로 결정

### 협력이라는 문맥 안에서 책임을 결정하라
* 객체에게 할당된 책임의 품질은 협력에 적합한 정도로 결정된다. 
* 협력을 시작하는 주체는 메시지 전송자이기 때문에 협력에 적합한 책임이란 메시지 수신자가 아니라 메시지 전송자에게 적합한 책임을 의미한다. 

#### 협력에 적합한 책음을 수확히기 위해서는...
객체를 결정한 후에 메시지를 선택하는 것이 아니라 메시지를 결정한 후에 객체를 선택해야한다. 메시지가 존재하기 때문에 그 메시지를 처리할 객체가 필요한 것이다. 
> 메시지 기반의 설계 관점은 클래스 기반의 설계 관점보다 훨씬 유연한 애플리케이션을 만들 수 있게 해준다. 
* 메시지가 클라이언트의 의도를 표현한다.
* 객체를 결정하기 전에 객체가 수신할 메시지를 먼저 결정한다. 
* 메시지를 수신하기로 결정된 객체는 메시지를 처리할 **책임**을 할당 받게 된다. 
* 메시지를 먼저 결정하기 때문에 메시지 송신자는 메시지 수신자에 대한 어떠한 가정도 할 수 었다. 
    * 메시지 전송자의 관점에서 메시지 수신자가 캡슐화 되는것.

### 책임 주도 설계
* 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
* 시스템 책임을 더 작은 책임으로 분할한다.
* 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
* 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
* 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.

## 책임 할당을 위한 GRASP 패턴
General Responsibility Assignment Software Pattern(일반적인 책임 할당을 위한 소프트웨어 패턴)의 약자.
객체에게 책임을 할당 할 때 지침으로 삼을 수 있는 원칙들의 집합을 패턴 형식으로 정리

### 도메인 개념에서 출발하기
* 설계를 시작하기 전에 도메인에 대한 개략적인 모습을 그려 보는 것이 유용
* 도메인 안에는 무수히 많은 개념들이 존재, 이 도메인 개념들을 책임 할당의 대상으로 사용하면 코드에 도메인 모습을 투영하기가 쉬워짐
* 설게 시작 단계에서는 개념들의 이미와 관계가 정확하거나 완벽할 필요x
* 이 단계에서는 책임을 할당 받을 객체들의 종류와 관계에 대한 유용한 정보를 제공할 수 있다면 충분

### 정보 전문가에게 책임을 할당하라
* 책임 주도 설계 방식의 첫 단계: 애플리케이션이 제공해야 하는 기능을 애플리케이션의 책임으로 생각하는 것
* 이 책임을 애플리케이션에 대해 전송된 메시지로 간주
* 이 메시지를 책임질 첫 번째 겍체를 선택하는것으로 설계를 시작
---
1. 메시지를 전송할 객체는 무엇을 원하는가?
2. 메시지를 수신할 적합한 객체는 누구인가?  
이 질문에 답하기 위해서는 객체가 상태와 행동을 통합한 캡슐화의 단위라는 사실에 집중해야함. **객체는 자신의 상태를 스스로 처리하는 자율적인 존재여야한다.** 객체의 책임과 책임을 수행하는데 필요한 상태는 동일한 객체 안에 존재해야함. 즉, **객체에게 책임을 할당하는 첫 번째 원칙은 책임을 수행할 정보를 알고 있는 객체에게 책임을 할당하는 것이다.** 이를 `INFORMATION EXPERT(정보 전문가)`패턴 이라고 한다.

### 높은 응집도와 낮은 결합도
높은 응집도와 낮은 결합도는 객체에 책임을 할당할 때 항상 고려해야하는 기본 원리다. 책임을 할당할 수 있는 다양한 대안들이 존재한다면 응집도와 결합도의 측면에서 더 나은 대안을 선택해야한다. 이를 `LOW COUPLING(낮은 결합도)` 패턴과 `HIGH COHESION(높은 응집도)` 패턴 이라고 부른다. 

### 창조자에게 객체 생성 책임을 할당하라
`CREATOR(창조자)`패턴은 객체를 생성할 책임을 어떤 객체에게 할당할지에 대한 지침을 제공한다.   
객체 A를 생성할 때 아래 조건을 최대한 많이 만족하는 B에게 객체 생성 책임을 할당하라.
* B가 A 객체를 포함하거나 참조한다.
* B가 A 객체를 기록한다.
* B가 A 객체를 긴밀하게 사용한다. 
* B가 A 객체를 초기화하는 데 필요한 데이터를 가지고 있다.(이 경우 B는 A에 대한 정보 전문가다) 

### 클래스 응집도 판단하기
클래스가 다음과 같은 특징을 가지고있다면, 클래스의 응집도는 낮다고 할 수 있다.
* 클래스가 하나 이상의 이유로 변경되어야 한다면 응집도가 낮은 것이다. 변경의 이유를 기준으로 클래스를 분리하자.
* 클래스의 인스턴스를 초기화 하는 시점에 경우에 따라 서로 다른 속성들을 초기화하고 있다면 응집도가 낮은 것이다. 초기화되는 속성의 그릅을 기준으로 클래스를 분리하라.
* 메서드 그룹이 속성 그룹을 사용하는지 여부로 나뉜다면 응집도가 낮은 것이다. 이들 그룹을 기준으로 클래스를 분리하라.

### POLYMORPHISM (다형성) 페턴
객체의 타입에 따라 변하는 행동이 있다면 타입을 분리하고 변화하는 행동을 각 타입의 책임으로 할당하는 것.

### PROTECTED VARIATION(변경 보호) 패턴
변경을 캡슐화하도록 책임을 할당하는 것
* 변화가 예상되는 불안정한 지점들을 식별하고 그 주위에 안정된 인터페이스를 형셩하도록 책임을 할당하는 것


